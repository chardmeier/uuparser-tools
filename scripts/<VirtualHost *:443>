<VirtualHost *:443>
  SSLEngine On
  SSLProxyEngine On
  ProxyPreserveHost On

  SSLProxyEngine on
  SSLProxyCheckPeerCN off
  SSLProxyCheckPeerName off
  SSLProxyCheckPeerExpire off

  <Location "/jhub">
      ProxyPass        https://127.0.0.1:8000/jhub
      ProxyPassReverse https://127.0.0.1:8000/jhub
  </Location>

  <Location "/jhub/api/kernels">
      ProxyPass        wss://127.0.0.1:8000/jhub/api/kernels
      ProxyPassReverse wss://127.0.0.1:8000/jhub/api/kernels
  </Location>
  <Location "/jhub/terminals/websocket">
      ProxyPass        wss://127.0.0.1:8000/jhub/terminals/websocket
      ProxyPassReverse wss://127.0.0.1:8000/jhub/terminals/websocket
  </Location>

  # configure SSL
  ServerName zxy.mooo.com
  Include /etc/letsencrypt/options-ssl-apache.conf
  SSLCertificateFile /etc/letsencrypt/live/zxy.mooo.com/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/zxy.mooo.com/privkey.pem
  SSLProtocol All -SSLv2 -SSLv3
  SSLOpenSSLConfCmd DHParameters /etc/letsencrypt/live/zxy.mooo.com/fullchain.pem
  SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH

</VirtualHost>


<VirtualHost *:80>
        ServerName zxy.mooo.com
</VirtualHost>
<IfModule mod_ssl.c>
    <VirtualHost *:443>
            ServerName zxy.mooo.com

            ErrorLog ${APACHE_LOG_DIR}/error.log
            CustomLog ${APACHE_LOG_DIR}/com.example-access.log combined

            SSLProxyEngine On
            SSLProxyVerify none
            SSLProxyCheckPeerCN off
            SSLProxyCheckPeerName off
            SSLProxyCheckPeerExpire off

            Redirect permanent / https://zxy.mooo.com/jhub

            <Location "/jhub">
                    ProxyPass https://localhost:8000/jhub
                    ProxyPassReverse https://localhost:8000/jhub
                    ProxyPassReverseCookieDomain localhost zxy.mooo.com
                    RequestHeader set Origin "https://localhost:8000"
            </Location>

            <Location "/jhub/api/kernels">
                    ProxyPass ws://localhost:8000/jhub/api/kernels
                    ProxyPassReverse ws://localhost:8000/jhub/api/kernels
                    ProxyPass wss://localhost:8000/jhub/api/kernels
                    ProxyPassReverse wss://localhost:8000/jhub/api/kernels
            </Location>
    </VirtualHost>
</IfModule>